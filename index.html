<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Highlighting Example</title>
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/themes/prism-tomorrow.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            /* Ensure moving text stays within viewport */
        }

        .main-container {
            max-width: 1700px;
        }

        pre {
            height: 700px;
            width: 90%;
            max-width: 1200px;
            margin: 20px;
        }

        .code-container {
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 30px;
            justify-content: space-between;
        }

        .scroll-container {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
        }

        ::-webkit-scrollbar {
            width: 0px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #acacac;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #7e7e7e;
        }

        /* 
        .moving-text {
            position: absolute;
            font-size: 25px;
            padding: 10px;
            animation: moveText 50s linear infinite;
        }

        .moving-text-reverse{
            position: absolute;
            padding: 10px;
            animation: moveTextReverse 50s linear infinite;
            font-size: 25px;

        }

        @keyframes moveText {
            0% { top: 0; left: 0; }
            25% { top: 0; left: calc(100% - 200px); }
            50% { top: calc(100% - 50px); left: calc(100% - 200px); }
            75% { top: calc(100% - 50px); left: 0; }
            100% { top: 0; left: 0; }
        }
        @keyframes moveTextReverse {
            0% { top: calc(100% - 50px); left: calc(100% - 200px); }
            25% { top: calc(100% - 50px); left: 0; }
            50% { top: 0; left: 0; }
            75% { top: 0; left: calc(100% - 200px); }
            100% { top: calc(100% - 50px); left: calc(100% - 200px); }
        } */
    </style>
</head>

<body>
    <div class="main-container">
        <h1>Sequelize query for get the result in single object while relationship of two or more table are in use</h1>
        <!-- Code Block -->
        <div class="code-container">
            <pre id="scroll-container"><code class="language-javascript">
import { Employee } from "../../models/employee.model.js";
import { Branch } from "../../models/branch.model.js";
import { sequelize } from "../../models/index.js";

    getAllEmployee = async (req, res, next) => {
        try {
            const employees = await Employee.findAll({
                attributes: {
                    include: [
                        [sequelize.col('branch.branch_name'), 'branch'],
                        [sequelize.col('branch.branch_id'), 'branch_id'],
                    ], 
                },
                include: [
                    {
                        model: Branch,
                        as: 'branch',
                        attributes: [], // Avoid including nested attributes directly. Using this you specify that we don't need any data in object
                    },
                ],
                raw: true,
                // nest: true // Ensures a flat structure
            });
        
            res.json(employees);
        } catch (error) {
            res.status(500).json({ error: error.message });
        }
    };
            </code></pre>
            <pre id="scroll-container"><code class="language-javascript">
import { Employee } from "../../models/employee.model.js";
import { Branch } from "../../models/branch.model.js";
import { sequelize } from "../../models/index.js";
        
export class EmployeeController {

    getModelAttributes(model, aliasPrefix = '', attributes = null, attrForAlias = {}) {
        const attrList = attributes || Object.keys(model.getAttributes());
        return attrList.map(attr => [
            sequelize.col(`${aliasPrefix}${attr}`),
            attr
        ]);
    }

    getAllEmployee = async (req, res, next) => {
        // If you want to get all attributes of the model 
        const branchAllAttributes = this.getModelAttributes(Branch, 'branch.');
        // If you want to get specific attributes of the model
        const branchAttributes = this.getModelAttributes(Branch, 'branch.', ['branch_name', 'branch_id', 'branch_mgr_id']);
        //If you want to give alias to some attributes
        const attrForAlias = {
            branch_name: 'b_name'
        };
        const branchAttributesAlias = this.getModelAttributes(Branch, 'branch.', ['branch_name', 'branch_id'], attrForAlias);
        try {
            const employees = await Employee.findAll({
                attributes: {
                    include: branchAttributes, 
                },
                include: [
                    {
                        model: Branch,
                        as: 'branch',
                        attributes: [], // Avoid including nested attributes directly. Using this you specify that we don't need any data in object
                    },
                ],
                raw: true,
                // nest: true // Ensures a flat structure
            });
        
            res.json(employees);
        } catch (error) {
            res.status(500).json({ error: error.message });
        }
    };
}
            </code></pre>
        </div>
        <div class="code-container">
            <h3>Direct add column in inculde</h3>
            <h3>Add column using common function</h3>
        </div>
    </div>

    <!-- Moving text -->
    <!-- <div class="moving-text">Ayush Kanani</div>
    <div class="moving-text-reverse"> Upendra Yadav</div> -->

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.28.0/prism.js"></script>
</body>

</html>